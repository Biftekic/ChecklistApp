{
  "session_id": "0d8f7d1f-ea41-4251-b568-16d0da5567cb",
  "transcript_path": "/home/tinpavlic1/.claude/projects/-home-tinpavlic1-claude-projects-ChecklistApp/0d8f7d1f-ea41-4251-b568-16d0da5567cb.jsonl",
  "hook_event_name": "PreToolUse",
  "tool_name": "Edit",
  "tool_input": {
    "file_path": "/home/tinpavlic1/claude-projects/ChecklistApp/app/templates/[id]/preview/page.tsx",
    "old_string": "",
    "new_string": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { PageWrapper } from '@/components/layout/page-wrapper';\nimport { ChecklistPreview } from '@/components/checklist/checklist-preview';\nimport { ExportOptions } from '@/components/checklist/export-options';\nimport { ChecklistMetadata } from '@/components/checklist/checklist-metadata';\nimport { Button } from '@/components/ui/button';\nimport { ArrowLeft, Edit3 } from 'lucide-react';\nimport { useCustomizationStore } from '@/lib/stores/customization-store';\nimport { templateEngine } from '@/lib/services/template-engine';\nimport { GeneratedChecklist } from '@/lib/types/template';\n\nexport interface ChecklistMetadataType {\n  clientName: string;\n  location: string;\n  serviceDate: string;\n  assignedStaff: string[];\n  notes: string;\n}\n\nexport default function PreviewPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { \n    selectedTemplate, \n    selectedRooms, \n    selectedTasks, \n    customTasks, \n    editedTasks,\n    currentStep,\n    setCurrentStep \n  } = useCustomizationStore();\n  \n  const [generatedChecklist, setGeneratedChecklist] = useState<GeneratedChecklist | null>(null);\n  const [metadata, setMetadata] = useState<ChecklistMetadataType>({\n    clientName: '',\n    location: '',\n    serviceDate: new Date().toISOString().split('T')[0],\n    assignedStaff: [],\n    notes: '',\n  });\n  const [isPrintMode, setIsPrintMode] = useState(false);\n\n  useEffect(() => {\n    // Generate the checklist from the current state\n    if (selectedTemplate) {\n      const checklist = templateEngine.generateChecklist({\n        selectedTemplate,\n        selectedRooms,\n        selectedTasks,\n        customTasks,\n        editedTasks\n      });\n      setGeneratedChecklist(checklist);\n    }\n  }, [selectedTemplate, selectedRooms, selectedTasks, customTasks, editedTasks]);\n\n  useEffect(() => {\n    // Set the current step to review when this page loads\n    setCurrentStep('review');\n  }, [setCurrentStep]);\n\n  const handleMetadataUpdate = (updatedMetadata: ChecklistMetadataType) => {\n    setMetadata(updatedMetadata);\n  };\n\n  const handleEditClick = () => {\n    router.push(`/templates/${params.id}/tasks`);\n  };\n\n  const handleBackClick = () => {\n    router.push(`/templates/${params.id}/tasks`);\n  };\n\n  if (!generatedChecklist || !selectedTemplate) {\n    return (\n      <PageWrapper>\n        <div className=\"flex min-h-[60vh] items-center justify-center\">\n          <div className=\"text-center\">\n            <h2 className=\"mb-2 text-2xl font-semibold\">No checklist found</h2>\n            <p className=\"mb-4 text-muted-foreground\">\n              Please complete the template customization first.\n            </p>\n            <Button onClick={() => router.push('/templates')}>\n              Go to Templates\n            </Button>\n          </div>\n        </div>\n      </PageWrapper>\n    );\n  }\n\n  return (\n    <PageWrapper>\n      <div className={`px-4 py-8 sm:px-6 sm:py-12 ${isPrintMode ? 'print:px-0' : ''}`}>\n        <div className=\"mx-auto max-w-7xl\">\n          {/* Header */}\n          <div className=\"mb-8 print:hidden\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={handleBackClick}\n                >\n                  <ArrowLeft className=\"h-5 w-5\" />\n                </Button>\n                <div>\n                  <h1 className=\"text-3xl font-bold tracking-tight\">\n                    Preview & Export\n                  </h1>\n                  <p className=\"mt-1 text-muted-foreground\">\n                    Review your customized checklist and export in your preferred format\n                  </p>\n                </div>\n              </div>\n              <Button\n                onClick={handleEditClick}\n                variant=\"outline\"\n                className=\"flex items-center gap-2\"\n              >\n                <Edit3 className=\"h-4 w-4\" />\n                Edit Checklist\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid gap-8 lg:grid-cols-3\">\n            {/* Main Preview Section */}\n            <div className=\"lg:col-span-2\">\n              {/* Metadata Form */}\n              <div className=\"mb-8 print:hidden\">\n                <ChecklistMetadata\n                  metadata={metadata}\n                  onUpdate={handleMetadataUpdate}\n                />\n              </div>\n\n              {/* Checklist Preview */}\n              <ChecklistPreview\n                checklist={generatedChecklist}\n                template={selectedTemplate}\n                metadata={metadata}\n                isPrintMode={isPrintMode}\n              />\n            </div>\n\n            {/* Export Options Sidebar */}\n            <div className=\"print:hidden\">\n              <div className=\"sticky top-8\">\n                <ExportOptions\n                  checklist={generatedChecklist}\n                  metadata={metadata}\n                  onPrintModeToggle={setIsPrintMode}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </PageWrapper>\n  );\n}"
  }
}